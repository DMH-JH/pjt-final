{% extends 'base.html' %}

{% block content %}
  <h2>WorldCup</h2>
  <h4>내가 선택한 영화: </h4>
  <hr>
  <div class="row">
    {% for movie in movies %}
      <div class="movie-images col-6">
        <img class="img" id="img-{{ movie.pk }}" data-movie-pk="{{ movie.pk }}" src="https://image.tmdb.org/t/p/original/{{ movie.poster_path }}"alt="">
      </div>
    {% endfor %}
  </div>
{% endblock content %}

{% block script %}
  <script>
  let pageNum = 2
  let seletedMoviePks = []

  const images = document.querySelectorAll('.movie-images')
  console.log(images)
  images.forEach((image) => {
    image.addEventListener('click', (event) => {
      seletedMoviePks.push(event.target.dataset.moviePk)
      console.log(seletedMoviePks)
      axios({
        method: 'get',
        url: `/movies/worldcup/?page=${pageNum}`,
        headers: {'x-requested-with': 'XMLHttpRequest'}
      })
        .then((res) => {
          const movies = res.data
          moviePk = movies[0].pk
          moviePosterPath = movies[0].fields.poster_path

          const image1 = document.querySelector(`#img-${event.target.dataset.moviePk}`)
          const newImg = document.createElement('img')
          newImg.classList.add('img')
          newImg.src = `https://image.tmdb.org/t/p/original/${moviePosterPath}`
          newImg.id = `img-${moviePk}`
          newImg.dataset.moviePk = `${movies[0].pk}`

          console.log(newImg)

          moviePk2 = movies[1].pk
          // const image2 = document.querySelector(`#img-${event.target.dataset.moviePk}`)
          // const newImg = document.createElement('img')
          // newImg.classList.add('img')
          // newImg.src = `https://image.tmdb.org/t/p/original/${moviePosterPath}`
          // newImg.id = `img-${moviePk}`
          // console.log(newImg)

          // movieDiv.innerHTML = movieHTML
          const parent = image1.parentNode
          parent.replaceChild(newImg, image1)
          pageNum += 1
        })
    })
  })

  </script>
{% endblock script %}


